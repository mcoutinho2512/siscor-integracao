{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matriz Decis√≥ria - COR Rio</title>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <!-- COR Styles -->
    <link rel="stylesheet" href="{% static 'mapa_novo/css/cor_navbar.css' %}">
    <link rel="stylesheet" href="{% static 'mapa_novo/css/cor_menu.css' %}">
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f1f5f9;
            color: #1e293b;
        }

        /* ===== LAYOUT PRINCIPAL ===== */
        .matriz-container {
            margin-left: 280px;
            padding: 24px;
            min-height: calc(100vh - 70px);
            margin-top: 70px;
            background: #f1f5f9;
        }

        @media (max-width: 1024px) {
            .matriz-container {
                margin-left: 0;
            }
        }

        /* ===== HEADER DA P√ÅGINA ===== */
        .matriz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        .matriz-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .matriz-title i {
            font-size: 28px;
            color: #3b82f6;
        }

        .matriz-title h1 {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
        }

        .matriz-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn-update {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-update:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-update.loading i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        .last-update {
            font-size: 12px;
            color: #64748b;
        }

        /* ===== EST√ÅGIO OPERACIONAL ===== */
        .estagio-section {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .estagio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .estagio-display {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .estagio-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            background: rgba(255, 255, 255, 0.9);
            border: 3px solid currentColor;
        }

        .estagio-icon.e1 { color: #10b981; border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .estagio-icon.e2 { color: #eab308; border-color: #eab308; background: rgba(234, 179, 8, 0.1); }
        .estagio-icon.e3 { color: #f97316; border-color: #f97316; background: rgba(249, 115, 22, 0.1); }
        .estagio-icon.e4 { color: #ef4444; border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .estagio-icon.e5 { color: #a855f7; border-color: #a855f7; background: rgba(168, 85, 247, 0.1); }

        .estagio-info h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #1e293b;
        }

        .estagio-info p {
            color: #64748b;
            font-size: 14px;
            margin: 0;
        }

        .estagio-stats {
            display: flex;
            gap: 24px;
        }

        .estagio-stat {
            text-align: center;
            padding: 16px 24px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .estagio-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #3b82f6;
        }

        .estagio-stat-label {
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
            margin-top: 4px;
        }

        /* Barra de Progresso */
        .progress-container {
            margin-top: 24px;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-label {
            font-size: 12px;
            color: #64748b;
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 14px;
        }

        .progress-fill.e1 { background: linear-gradient(90deg, #10b981, #059669); }
        .progress-fill.e2 { background: linear-gradient(90deg, #eab308, #ca8a04); }
        .progress-fill.e3 { background: linear-gradient(90deg, #f97316, #ea580c); }
        .progress-fill.e4 { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .progress-fill.e5 { background: linear-gradient(90deg, #a855f7, #9333ea); }

        /* Indicadores de N√≠vel */
        .nivel-indicadores {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .nivel-indicador {
            background: #f8fafc;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .nivel-indicador.ativo {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }

        .nivel-indicador-nome {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #475569;
        }

        .nivel-indicador-status {
            font-size: 24px;
        }

        /* ===== SE√á√ïES ===== */
        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #1e293b;
        }

        .section-title i {
            color: #3b82f6;
        }

        /* ===== SITUA√á√ÉO METEOROL√ìGICA ===== */
        .meteo-section {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .meteo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }

        .meteo-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .meteo-card i {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .meteo-card.chuva i { color: #06b6d4; }
        .meteo-card.vento i { color: #64748b; }
        .meteo-card.sirene i { color: #ef4444; }
        .meteo-card.temp i { color: #f59e0b; }

        .meteo-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
            color: #1e293b;
        }

        .meteo-label {
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
        }

        /* ===== GATILHOS GRID ===== */
        .gatilhos-section {
            margin-bottom: 24px;
        }

        .gatilhos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 20px;
        }

        /* ===== GATILHO CARD ===== */
        .gatilho-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .gatilho-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .gatilho-card.ativo {
            border-left: 4px solid #ef4444;
        }

        .gatilho-card.inativo {
            border-left: 4px solid #cbd5e1;
        }

        .gatilho-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .gatilho-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .gatilho-title i {
            font-size: 24px;
        }

        .gatilho-title h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-badge.ativo {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .status-badge.inativo {
            background: #f1f5f9;
            color: #64748b;
        }

        /* Progresso do Gatilho */
        .gatilho-progress {
            margin-bottom: 20px;
        }

        .gatilho-progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .gatilho-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .gatilho-progress-fill.g1 { background: linear-gradient(90deg, #06b6d4, #0891b2); }
        .gatilho-progress-fill.g2 { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .gatilho-progress-fill.g3 { background: linear-gradient(90deg, #8b5cf6, #7c3aed); }
        .gatilho-progress-fill.g4 { background: linear-gradient(90deg, #ec4899, #db2777); }

        .gatilho-progress-label {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: #64748b;
        }

        /* Detalhes do Gatilho */
        .gatilho-details {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .detail-label {
            font-size: 13px;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-label i {
            font-size: 14px;
        }

        .detail-value {
            font-size: 14px;
            font-weight: 700;
            color: #1e293b;
        }

        /* Grid de Modais (G3) */
        .modais-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .modal-item {
            text-align: center;
            padding: 10px 6px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .modal-item.normal {
            border-color: rgba(16, 185, 129, 0.4);
            background: rgba(16, 185, 129, 0.05);
        }

        .modal-item.atencao {
            border-color: rgba(245, 158, 11, 0.4);
            background: rgba(245, 158, 11, 0.1);
        }

        .modal-item.interrompido {
            border-color: rgba(239, 68, 68, 0.4);
            background: rgba(239, 68, 68, 0.1);
        }

        .modal-nome {
            font-size: 10px;
            color: #64748b;
            margin-bottom: 4px;
        }

        .modal-status {
            font-size: 16px;
        }

        /* ===== RESPONSIVO ===== */
        @media (max-width: 768px) {
            .estagio-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .estagio-stats {
                flex-wrap: wrap;
            }

            .nivel-indicadores {
                grid-template-columns: repeat(2, 1fr);
            }

            .gatilhos-grid {
                grid-template-columns: 1fr;
            }

            .modais-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    {% include 'includes/navbar_top.html' %}
    {% include 'includes/navbar_menu.html' %}

    <div class="matriz-container">
        <!-- Header -->
        <div class="matriz-header">
            <div class="matriz-title">
                <i class="bi bi-grid-3x3-gap-fill"></i>
                <h1>Matriz Decis√≥ria</h1>
            </div>
            <div class="matriz-actions">
                <span class="last-update" id="lastUpdate">√öltima atualiza√ß√£o: --:--:--</span>
                <button class="btn-update" onclick="atualizarDados()" id="btnUpdate">
                    <i class="bi bi-arrow-clockwise"></i>
                    Atualizar
                </button>
            </div>
        </div>

        <!-- Est√°gio Operacional -->
        <section class="estagio-section">
            <div class="estagio-header">
                <div class="estagio-display">
                    <div class="estagio-icon e1" id="estagioIcon">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <div class="estagio-info">
                        <h2 id="estagioNome">Est√°gio 1 - Normalidade</h2>
                        <p id="estagioDesc">Opera√ß√£o normal da cidade</p>
                    </div>
                </div>
                <div class="estagio-stats">
                    <div class="estagio-stat">
                        <div class="estagio-stat-value" id="valorEstagio">0.36</div>
                        <div class="estagio-stat-label">Valor Indicado</div>
                    </div>
                    <div class="estagio-stat">
                        <div class="estagio-stat-value" id="proximidade">27.5%</div>
                        <div class="estagio-stat-label">Pr√≥ximo N√≠vel</div>
                    </div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-labels">
                    <span class="progress-label">Est√°gio 1</span>
                    <span class="progress-label">Est√°gio 2</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill e1" id="progressoFill" style="width: 30%;">30%</div>
                </div>
            </div>

            <div class="nivel-indicadores">
                <div class="nivel-indicador" id="indicadorG1">
                    <div class="nivel-indicador-nome">G1 - Meteorol√≥gico</div>
                    <div class="nivel-indicador-status">‚ö™</div>
                </div>
                <div class="nivel-indicador" id="indicadorG2">
                    <div class="nivel-indicador-nome">G2 - Ocorr√™ncias</div>
                    <div class="nivel-indicador-status">‚ö™</div>
                </div>
                <div class="nivel-indicador" id="indicadorG3">
                    <div class="nivel-indicador-nome">G3 - Mobilidade</div>
                    <div class="nivel-indicador-status">‚ö™</div>
                </div>
                <div class="nivel-indicador" id="indicadorG4">
                    <div class="nivel-indicador-nome">G4 - Eventos</div>
                    <div class="nivel-indicador-status">‚ö™</div>
                </div>
            </div>
        </section>

        <!-- Situa√ß√£o Meteorol√≥gica -->
        <section class="meteo-section">
            <h3 class="section-title"><i class="bi bi-cloud-rain-fill"></i> Situa√ß√£o Meteorol√≥gica</h3>
            <div class="meteo-grid">
                <div class="meteo-card chuva">
                    <i class="bi bi-cloud-rain-heavy-fill"></i>
                    <div class="meteo-value" id="meteoChuva">4</div>
                    <div class="meteo-label">Pluvi√¥metros com Chuva</div>
                </div>
                <div class="meteo-card vento">
                    <i class="bi bi-wind"></i>
                    <div class="meteo-value" id="meteoVento">8.6</div>
                    <div class="meteo-label">Velocidade M√©dia (km/h)</div>
                </div>
                <div class="meteo-card sirene">
                    <i class="bi bi-megaphone-fill"></i>
                    <div class="meteo-value" id="meteoSirene">0</div>
                    <div class="meteo-label">Sirenes Alarmadas</div>
                </div>
                <div class="meteo-card temp">
                    <i class="bi bi-thermometer-half"></i>
                    <div class="meteo-value" id="meteoTemp">--</div>
                    <div class="meteo-label">N√≠vel de Calor</div>
                </div>
            </div>
        </section>

        <!-- Gatilhos -->
        <section class="gatilhos-section">
            <h3 class="section-title"><i class="bi bi-lightning-fill"></i> Gatilhos Operacionais</h3>
            <div class="gatilhos-grid">
                <!-- G1 -->
                <div class="gatilho-card inativo" id="cardG1">
                    <div class="gatilho-header">
                        <div class="gatilho-title">
                            <i class="bi bi-cloud-rain-fill" style="color: #06b6d4;"></i>
                            <h3>G1 - Meteorol√≥gico</h3>
                        </div>
                        <span class="status-badge inativo" id="badgeG1">Inativo</span>
                    </div>
                    <div class="gatilho-progress">
                        <div class="gatilho-progress-bar">
                            <div class="gatilho-progress-fill g1" id="progressoG1" style="width: 0%;"></div>
                        </div>
                        <div class="gatilho-progress-label">
                            <span>Progresso</span>
                            <span id="progressoG1Label">0%</span>
                        </div>
                    </div>
                    <div class="gatilho-details">
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-droplet-fill"></i> Pluvi√¥metros</span>
                            <span class="detail-value" id="g1Pluviometros">0 / 116</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-cloud-rain-heavy-fill"></i> Chuva Mod/Forte</span>
                            <span class="detail-value" id="g1ChuvaForte">0</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-megaphone-fill"></i> Sirenes</span>
                            <span class="detail-value" id="g1Sirenes">0 / 162</span>
                        </div>
                    </div>
                </div>

                <!-- G2 -->
                <div class="gatilho-card inativo" id="cardG2">
                    <div class="gatilho-header">
                        <div class="gatilho-title">
                            <i class="bi bi-exclamation-triangle-fill" style="color: #f59e0b;"></i>
                            <h3>G2 - Ocorr√™ncias</h3>
                        </div>
                        <span class="status-badge inativo" id="badgeG2">Inativo</span>
                    </div>
                    <div class="gatilho-progress">
                        <div class="gatilho-progress-bar">
                            <div class="gatilho-progress-fill g2" id="progressoG2" style="width: 0%;"></div>
                        </div>
                        <div class="gatilho-progress-label">
                            <span>Progresso</span>
                            <span id="progressoG2Label">0%</span>
                        </div>
                    </div>
                    <div class="gatilho-details">
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-exclamation-octagon-fill"></i> Cr√≠ticas</span>
                            <span class="detail-value" id="g2Critica">0</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-exclamation-triangle-fill"></i> Alta</span>
                            <span class="detail-value" id="g2Alta">0</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-info-circle-fill"></i> M√©dia/Baixa</span>
                            <span class="detail-value" id="g2Media">0</span>
                        </div>
                    </div>
                </div>

                <!-- G3 -->
                <div class="gatilho-card inativo" id="cardG3">
                    <div class="gatilho-header">
                        <div class="gatilho-title">
                            <i class="bi bi-bus-front-fill" style="color: #8b5cf6;"></i>
                            <h3>G3 - Mobilidade</h3>
                        </div>
                        <span class="status-badge inativo" id="badgeG3">Inativo</span>
                    </div>
                    <div class="gatilho-progress">
                        <div class="gatilho-progress-bar">
                            <div class="gatilho-progress-fill g3" id="progressoG3" style="width: 0%;"></div>
                        </div>
                        <div class="gatilho-progress-label">
                            <span>Progresso</span>
                            <span id="progressoG3Label">0%</span>
                        </div>
                    </div>
                    <div class="gatilho-details">
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-speedometer2"></i> Extens√£o (EAC)</span>
                            <span class="detail-value" id="g3EAC">0 km</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-exclamation-circle-fill"></i> Em Aten√ß√£o</span>
                            <span class="detail-value" id="g3Atencao">0</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-x-octagon-fill"></i> Interrompidos</span>
                            <span class="detail-value" id="g3Interrompidos">0</span>
                        </div>
                    </div>
                    <div class="modais-grid" id="modaisGrid"></div>
                </div>

                <!-- G4 -->
                <div class="gatilho-card inativo" id="cardG4">
                    <div class="gatilho-header">
                        <div class="gatilho-title">
                            <i class="bi bi-calendar-event-fill" style="color: #ec4899;"></i>
                            <h3>G4 - Grandes Eventos</h3>
                        </div>
                        <span class="status-badge inativo" id="badgeG4">Inativo</span>
                    </div>
                    <div class="gatilho-progress">
                        <div class="gatilho-progress-bar">
                            <div class="gatilho-progress-fill g4" id="progressoG4" style="width: 0%;"></div>
                        </div>
                        <div class="gatilho-progress-label">
                            <span>Progresso</span>
                            <span id="progressoG4Label">0%</span>
                        </div>
                    </div>
                    <div class="gatilho-details">
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-star-fill"></i> Evento Ativo</span>
                            <span class="detail-value" id="g4Evento">Nenhum</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-exclamation-octagon-fill"></i> Muito Alta</span>
                            <span class="detail-value" id="g4MuitoAlta">0</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label"><i class="bi bi-people-fill"></i> Total</span>
                            <span class="detail-value" id="g4Total">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        const API_URL = '/api/matriz-decisoria/';
        const INTERVALO_ATUALIZACAO = 30000;

        const estagios = {
            1: { nome: "Normalidade", desc: "Opera√ß√£o normal da cidade", icone: "bi-shield-check", classe: "e1" },
            2: { nome: "Aten√ß√£o", desc: "Aten√ß√£o √†s condi√ß√µes", icone: "bi-exclamation-circle", classe: "e2" },
            3: { nome: "Alerta", desc: "Alerta em vigor", icone: "bi-exclamation-triangle", classe: "e3" },
            4: { nome: "Mobiliza√ß√£o", desc: "Mobiliza√ß√£o de recursos", icone: "bi-exclamation-octagon", classe: "e4" },
            5: { nome: "Crise", desc: "Situa√ß√£o cr√≠tica", icone: "bi-x-octagon", classe: "e5" }
        };

        async function atualizarDados() {
            const btn = document.getElementById('btnUpdate');
            btn.classList.add('loading');
            
            try {
                const response = await fetch(API_URL);
                const dados = await response.json();
                exibirDados(dados);
                atualizarTimestamp();
            } catch (error) {
                console.error('Erro:', error);
            } finally {
                btn.classList.remove('loading');
            }
        }

        function exibirDados(dados) {
            const estagio = dados.EstagioOperacional?.EstagioOperacionalSugerido || 1;
            const progresso = dados.EstagioOperacional?.ProgressoEstagioOperacionalSugerido || 0;
            const valor = dados.EstagioOperacional?.ValorEstagioOperacionalSugerido || 0;
            const proximidade = dados.NivelIndicado?.ProximidadeNivelSeguinte || 0;
            
            const info = estagios[estagio];
            
            document.getElementById('estagioIcon').className = `estagio-icon ${info.classe}`;
            document.getElementById('estagioIcon').innerHTML = `<i class="bi ${info.icone}"></i>`;
            document.getElementById('estagioNome').textContent = `Est√°gio ${estagio} - ${info.nome}`;
            document.getElementById('estagioDesc').textContent = info.desc;
            document.getElementById('valorEstagio').textContent = valor.toFixed(2);
            document.getElementById('proximidade').textContent = proximidade.toFixed(1) + '%';
            
            const progressoFill = document.getElementById('progressoFill');
            progressoFill.style.width = `${progresso}%`;
            progressoFill.textContent = `${progresso}%`;
            progressoFill.className = `progress-fill ${info.classe}`;
            
            atualizarIndicador('indicadorG1', dados.NivelIndicado?.NivelG1 === 1);
            atualizarIndicador('indicadorG2', dados.NivelIndicado?.NivelG2 === 1);
            atualizarIndicador('indicadorG3', dados.NivelIndicado?.NivelG3 === 1);
            atualizarIndicador('indicadorG4', dados.NivelIndicado?.NivelG4 === 1);
            
            exibirG1(dados.NivelG1, dados.NivelIndicado?.NivelG1 === 1);
            exibirG2(dados.NivelG2, dados.NivelIndicado?.NivelG2 === 1);
            exibirG3(dados.NivelG3, dados.NivelIndicado?.NivelG3 === 1);
            exibirG4(dados.NivelG4, dados.NivelIndicado?.NivelG4 === 1);
            exibirMeteo(dados.NivelG1);
        }

        function atualizarIndicador(id, ativo) {
            const el = document.getElementById(id);
            el.classList.toggle('ativo', ativo);
            el.querySelector('.nivel-indicador-status').textContent = ativo ? 'üî¥' : '‚ö™';
        }

        function exibirG1(g1, ativo) {
            document.getElementById('cardG1').className = `gatilho-card ${ativo ? 'ativo' : 'inativo'}`;
            document.getElementById('badgeG1').className = `status-badge ${ativo ? 'ativo' : 'inativo'}`;
            document.getElementById('badgeG1').textContent = ativo ? 'ATIVO' : 'Inativo';
            
            const tabela = g1?.TabelaNivelG1 || {};
            const chuva = tabela.Chuva || {};
            const sirene = tabela.Sirene || {};
            
            const progresso = tabela.ProgressoNivelG1 || 0;
            document.getElementById('progressoG1').style.width = `${progresso}%`;
            document.getElementById('progressoG1Label').textContent = `${progresso}%`;
            
            const chuvaAtiva = (parseInt(chuva.ChuvaFraca) || 0) + (parseInt(chuva.ChuvaModerada) || 0) + 
                              (parseInt(chuva.ChuvaForte) || 0) + (parseInt(chuva.ChuvaMuitoForte) || 0);
            
            document.getElementById('g1Pluviometros').textContent = `${chuvaAtiva} / ${chuva.Total || 0}`;
            document.getElementById('g1ChuvaForte').textContent = (parseInt(chuva.ChuvaModerada) || 0) + (parseInt(chuva.ChuvaForte) || 0);
            document.getElementById('g1Sirenes').textContent = `${sirene.Alarmada || 0} / ${sirene.Total || 0}`;
            
            document.getElementById('meteoChuva').textContent = chuvaAtiva;
            document.getElementById('meteoSirene').textContent = sirene.Alarmada || 0;
        }

        function exibirG2(g2, ativo) {
            document.getElementById('cardG2').className = `gatilho-card ${ativo ? 'ativo' : 'inativo'}`;
            document.getElementById('badgeG2').className = `status-badge ${ativo ? 'ativo' : 'inativo'}`;
            document.getElementById('badgeG2').textContent = ativo ? 'ATIVO' : 'Inativo';
            
            const progresso = g2?.ProgressoNivelG2 || 0;
            document.getElementById('progressoG2').style.width = `${progresso}%`;
            document.getElementById('progressoG2Label').textContent = `${progresso}%`;
            
            document.getElementById('g2Critica').textContent = g2?.Critica || 0;
            document.getElementById('g2Alta').textContent = (g2?.MuitoAlta || 0) + (g2?.Alta || 0);
            document.getElementById('g2Media').textContent = (g2?.Media || 0) + (g2?.Baixa || 0);
        }

        function exibirG3(g3, ativo) {
            document.getElementById('cardG3').className = `gatilho-card ${ativo ? 'ativo' : 'inativo'}`;
            document.getElementById('badgeG3').className = `status-badge ${ativo ? 'ativo' : 'inativo'}`;
            document.getElementById('badgeG3').textContent = ativo ? 'ATIVO' : 'Inativo';
            
            const progresso = g3?.ProgressoNivelG3 || 0;
            document.getElementById('progressoG3').style.width = `${progresso}%`;
            document.getElementById('progressoG3Label').textContent = `${progresso}%`;
            
            document.getElementById('g3EAC').textContent = (g3?.Transito?.EAC || 0) + ' km';
            document.getElementById('g3Atencao').textContent = g3?.Modal?.ModalEmAtencao || 0;
            document.getElementById('g3Interrompidos').textContent = g3?.Modal?.ModalInterrompido || 0;
            
            const statusModal = g3?.StatusModal || {};
            document.getElementById('modaisGrid').innerHTML = Object.entries(statusModal).map(([modal, status]) => {
                let classe = status === 'Normal' ? 'normal' : status === 'Interrompido' ? 'interrompido' : 'atencao';
                let icone = status === 'Normal' ? '‚úÖ' : status === 'Interrompido' ? '‚ùå' : '‚ö†Ô∏è';
                return `<div class="modal-item ${classe}"><div class="modal-nome">${modal}</div><div class="modal-status">${icone}</div></div>`;
            }).join('');
        }

        function exibirG4(g4, ativo) {
            document.getElementById('cardG4').className = `gatilho-card ${ativo ? 'ativo' : 'inativo'}`;
            document.getElementById('badgeG4').className = `status-badge ${ativo ? 'ativo' : 'inativo'}`;
            document.getElementById('badgeG4').textContent = ativo ? 'ATIVO' : 'Inativo';
            
            const progresso = g4?.ProgressoNivelG4 || 0;
            document.getElementById('progressoG4').style.width = `${progresso}%`;
            document.getElementById('progressoG4Label').textContent = `${progresso}%`;
            
            document.getElementById('g4Evento').textContent = g4?.Evento || 'Nenhum';
            document.getElementById('g4MuitoAlta').textContent = g4?.MuitoAlta || 0;
            document.getElementById('g4Total').textContent = (g4?.MuitoAlta || 0) + (g4?.Alta || 0) + (g4?.Media || 0) + (g4?.Baixa || 0);
        }

        function exibirMeteo(g1) {
            const tabela = g1?.TabelaNivelG1 || {};
            const vento = tabela.Vento || {};
            document.getElementById('meteoVento').textContent = vento.VentoMediaH01 || '--';
            document.getElementById('meteoTemp').textContent = tabela.NivelCalor || '--';
        }

        function atualizarTimestamp() {
            document.getElementById('lastUpdate').textContent = `√öltima atualiza√ß√£o: ${new Date().toLocaleTimeString('pt-BR')}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            atualizarDados();
            setInterval(atualizarDados, INTERVALO_ATUALIZACAO);
        });
    </script>
</body>
</html>